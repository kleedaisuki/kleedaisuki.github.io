---
// src/pages/en/blog/index.astro
import BaseLayout from "@layouts/BaseLayout.astro";
import { useTranslations } from "@i18n/utils";
import { getCollection } from "astro:content";
import "@styles/blog.css";

const lang = "en";
const t = useTranslations(lang);

const posts = (await getCollection("blog"))
  .filter((p) => p.data.locale === lang)
  .sort(
    (a, b) => new Date(b.data.date).valueOf() - new Date(a.data.date).valueOf(),
  );
---

<BaseLayout pageTitle={t("blog.title")}>
  <div class="blog-container">
    <header class="blog-header">
      <h1 class="blog-title">{t("blog.title")}</h1>
      <p class="blog-description">{t("blog.description")}</p>
    </header>

    <main>
      <ul class="post-list">
        {
          posts.map((p) => (
            <li class="post-item">
              {/* [新增] 使用一个 div 包裹，应用 flex-direction: column */}
              <div class="post-content">
                <div class="post-meta">
                  <time datetime={p.data.date.toISOString()}>
                    {new Date(p.data.date).toLocaleDateString(lang, {
                      year: "numeric",
                      month: "long",
                      day: "numeric",
                    })}
                  </time>
                </div>

                <h2 class="post-title">
                  <a href={`/${p.data.locale}/blog/${p.data.slug}/`}>{p.data.title}</a>
                </h2>

                {p.data.description && (
                  <p class="post-description">{p.data.description}</p>
                )}

                {/* [新增] 渲染标签列表 */}
                {p.data.tags && p.data.tags.length > 0 && (
                  <ul class="post-tags">
                    {p.data.tags.map((tag) => (
                      <li class="tag-item">{tag}</li>
                    ))}
                  </ul>
                )}
              </div>
            </li>
          ))
        }
      </ul>
    </main>
  </div>
</BaseLayout>
