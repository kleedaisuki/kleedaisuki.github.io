---
// src/pages/index.astro
// 纯静态：用前端 0ms 跳转，记忆用户语言偏好；JS 关闭时提供无障碍链接。
---

<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <!-- 根路径不需要被收录，避免和 /zh/、/en/ 竞争 -->
        <meta name="robots" content="noindex" />
        <title>Redirecting…</title>
        <script is:inline>
            (function () {
                var KEY = "prefLocale";
                var supported = { zh: 1, en: 1 };

                // 1) URL 参数强制选择（例如 /?lang=en）
                var qp = new URLSearchParams(location.search).get("lang");
                var fromQuery = qp && supported[qp] ? qp : null;

                // 2) 记忆的偏好
                var saved = null;
                try {
                    saved = localStorage.getItem(KEY);
                } catch (e) {}

                // 3) 浏览器语言猜测（仅第一次）
                var nav =
                    (navigator.languages && navigator.languages[0]) ||
                    navigator.language ||
                    "";
                var guess = (nav + "").toLowerCase().startsWith("en")
                    ? "en"
                    : "zh";

                var target = fromQuery || saved || guess;

                // 记住选择
                try {
                    localStorage.setItem(KEY, target);
                } catch (e) {}

                var to = "/" + target + "/";
                if (location.pathname !== to) location.replace(to);
            })();
        </script>
        <!-- JS 被禁用时的兜底 -->
        <noscript><meta http-equiv="refresh" content="0; url=/zh/" /></noscript>
    </head>
    <body>
        <noscript>
            <p>
                请选择语言 / Choose your language:
                <a href="/zh/">中文</a> |
                <a href="/en/">English</a>
            </p>
        </noscript>
    </body>
</html>
